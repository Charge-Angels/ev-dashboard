<div class="main-content">
  <div class="card card-profile card-testimonial">
    <form [formGroup]="formGroup" class="form">
      <mat-tab-group (selectedIndexChange)="updateRoute($event)" [selectedIndex]="activeTabIndex"
        animationDuration="0ms" disableRipple="true" class="mat-tab-info">
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="mr-2">portrait</mat-icon>
            {{name.value}} {{firstName.value}}
          </ng-template>
          <div class="card-body">
            <div class="row">
              <div class="col-md-2 my-auto">
                <div class="rotating-card-container img-fluid"
                  [ngStyle]="{ 'pointer-events': this.isAdmin ? 'all' : 'none'}">
                  <div class="card card-rotate card-background img-thumbnail m-0" style="height: 100px">
                    <div class="front front-background bg-transparent"
                      [ngStyle]="{'background-image': 'url(' + image + ')', 'background-size' : 'contain', 'background-repeat': 'no-repeat'}">
                      <div class="card-body">
                      </div>
                    </div>
                    <div class="back back-background"
                      [ngStyle]="{'background-image': 'url(' + image + ')', 'background-size' : 'contain', 'background-repeat': 'no-repeat'}">
                      <div class="card-body">
                        <div class="justify-content-center">
                          <button mat-flat-button color="primary" class="mr-2">
                            <mat-icon (click)="file.click()">mode_edit</mat-icon>
                            <div style="display:none">
                              <input type="file" accept=".jpg, .jpeg, .png, .gif" [maxLength]="maxSize" name="..."
                                (change)="imageChanged($event)" #file>
                            </div>
                          </button>
                          <button mat-flat-button color="warn">
                            <mat-icon (click)="clearImage()">delete</mat-icon>
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-md-10">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="name" appSetAutoFocus matInput placeholder="{{'users.name' | translate}}"
                      required (input)="toUpperCase(name)" type="text">
                    <mat-error *ngIf="name.hasError('required')">
                      {{"general.mandatory_field" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="firstName" matInput placeholder="{{'users.first_name' | translate}}" required
                      type="text">
                    <mat-error *ngIf="firstName.hasError('required')">
                      {{"general.mandatory_field" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="email" matInput placeholder="{{'users.email' | translate}}" required
                      type="text">
                    <mat-error *ngIf="email.hasError('email')">
                      {{"authentication.invalid_email" | translate}}
                    </mat-error>
                    <mat-error *ngIf="email.hasError('required')">
                      {{"general.mandatory_field" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <mat-select [formControl]="locale" placeholder="{{'users.locale' | translate}}">
                      <mat-option *ngFor="let userLocale of userLocales" [value]="userLocale.key">
                        {{userLocale.value | translate}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="phone" matInput placeholder="{{'users.phone' | translate}}" type="text">
                    <mat-error *ngIf="phone.hasError('pattern')">
                      {{"users.invalid_phone_number" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="mobile" matInput placeholder="{{'users.mobile' | translate}}" type="text">
                    <mat-error *ngIf="mobile.hasError('pattern')">
                      {{"users.invalid_phone_number" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div *ngIf="isAdmin" class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <mat-select [formControl]="status" placeholder="{{'users.status' | translate}}">
                      <mat-option *ngFor="let userStatus of userStatuses" [value]="userStatus.key">
                        {{userStatus.value | translate}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              <div *ngIf="isAdmin" class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <mat-select [formControl]="role" placeholder="{{'users.role' | translate}}">
                      <mat-option *ngFor="let userRole of userRoles" [value]="userRole.key">
                        {{userRole.value | translate}}
                      </mat-option>
                    </mat-select>
                  </mat-form-field>
                </div>
              </div>
              <div *ngIf="isAdmin" class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="tagIDs" matInput placeholder="{{'users.tag_ids' | translate}}" type="text">
                    <mat-hint>{{"users.tag_ids_help" | translate}}</mat-hint>
                    <mat-error *ngIf="tagIDs.hasError('pattern')">
                      {{"users.invalid_tag_ids" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div *ngIf="isAdmin" class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="plateID" matInput placeholder="{{'users.plate_id' | translate}}" type="text">
                    <mat-error *ngIf="plateID.hasError('pattern')">
                      {{"users.invalid_plate_id" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="mr-2">location_on</mat-icon>
            {{'general.address' | translate}}
          </ng-template>
          <div class="card-body">
            <app-address-cmp [formGroup]="formGroup" [hideGeoLocation]="true"></app-address-cmp>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="mr-2">lock</mat-icon>
            {{'authentication.password' | translate}}
          </ng-template>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="password" [type]="hidePassword ? 'password' : 'text'" matInput
                      placeholder="{{'authentication.password' | translate}}" type="password">
                    <mat-icon (click)="hidePassword = !hidePassword" class="icon-clickable" matSuffix>{{hidePassword ?
                    'visibility' :
                    'visibility_off'}}
                    </mat-icon>
                    <mat-error *ngIf="password.hasError('noSpace')">
                      {{"authentication.no_space_in_password" | translate}}
                    </mat-error>
                    <mat-error *ngIf="password.hasError('invalidPassword')">
                      {{"authentication.password_rule" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [errorStateMatcher]="parentErrorStateMatcher" [formControl]="repeatPassword"
                      [type]="hideRepeatPassword ? 'password' : 'text'" matInput
                      placeholder="{{'authentication.repeat_password' | translate}}" type="password">
                    <mat-icon (click)="hideRepeatPassword = !hideRepeatPassword" class="icon-clickable" matSuffix>
                      {{hideRepeatPassword
                    ? 'visibility' : 'visibility_off'}}
                    </mat-icon>
                    <mat-error *ngIf="passwords.hasError('notEqual')">
                      {{"authentication.password_not_equal" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="mr-2">link</mat-icon>
            {{'general.connectors' | translate}}
          </ng-template>
          <div class="card-body">
            <div class="row">
              <div class="col-md-4">
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex flex-row align-items-center">
                      <img src="/assets/img/integrations/concur-logo.png" class="card-logo img-thumbnail mr-3" />
                      <h2 class="card-title">Concur</h2>
                    </div>
                  </div>
                  <div class="card-footer">
                    <div class="d-flex flex-row align-items-center justify-content-between">
                      <div *ngIf="concurConnection && concurConnection.createdAt">
                        {{ concurConnection.createdAt | appDate:localeService.getCurrentFullLocaleForJS():'datetime'}}
                      </div>
                      <a href="https://www.concursolutions.com" target="_blank">
                        <mat-icon>launch</mat-icon>
                      </a>
                    </div>
                  </div>

                  <div *ngIf="!alreadyLinkedToConcur()"
                    class="card-img-overlay card-disabled d-inline-flex justify-content-end">
                    <button mat-raised-button color="primary" (click)="linkConcurAccount()" class="align-self-end mr-2 mb-2">
                      <mat-icon class="mr-1">launch</mat-icon>Connect
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon class="mr-2">more_horiz</mat-icon>
            {{'users.miscs' | translate}}
          </ng-template>
          <div class="card-body">
            <div class="row">
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="iNumber" matInput placeholder="{{'users.inumber' | translate}}" type="text">
                    <mat-error *ngIf="iNumber.hasError('pattern')">
                      {{"general.invalid_value" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
              <div class="col-md-6">
                <div class="form-group">
                  <mat-form-field>
                    <input [formControl]="costCenter" matInput placeholder="{{'users.cost_center' | translate}}"
                      type="text">
                    <mat-error *ngIf="costCenter.hasError('pattern')">
                      {{"general.invalid_value" | translate}}
                    </mat-error>
                  </mat-form-field>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-1">
                <button mat-raised-button color="primary" (click)="getInvoice()">
                  <mat-icon class="mr-1">receipt</mat-icon>View invoice
                </button>
              </div>
            </div>

          </div>
        </mat-tab>
        <mat-tab disabled>
          <ng-template mat-tab-label>
            <button mat-button (click)="saveUser(formGroup.value)"
              [disabled]="!formGroup.valid || !formGroup.dirty">
              <mat-icon class="mr-1">save</mat-icon>{{'general.save' | translate}}
            </button>
            <button mat-icon-button *ngIf="inDialog" mat-dialog-close>
              <mat-icon>close</mat-icon>
            </button>
          </ng-template>
        </mat-tab>
      </mat-tab-group>
    </form>
  </div>
</div>